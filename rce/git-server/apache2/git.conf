<VirtualHost *:80>
  Define GIT_CORE_DIR /usr/lib/git-core
  Define GIT_CGI_WRAPPER /opt/twgit/cgi-bin/twgit-backend
  Define APACHE_LOG_DIR /var/log/apache2
  ServerAdmin gitmeister@twitter.com

  SetEnv GIT_PROJECT_ROOT /srv/git
  SetEnv GIT_HTTP_EXPORT_ALL
  SetEnv GIT_HTTP_MAX_REQUEST_BUFFER 100M
  SetEnv GIT_BIN /usr/bin/git
  SetEnv TWGIT_DEBUG true

  #SetEnvIf Request_URI "^/git/source-wip([0-9])" GIT_NAMESPACE=wip$1
  #ScriptAliasMatch ^/git/[^/]*(.*) ${GIT_CGI_WRAPPER}/full.git$1

  ScriptAlias /git/ ${GIT_CGI_WRAPPER}/
  AliasMatch ^/git/(.*/objects/[0-9a-f]{2}/[0-9a-f]{38})$          /srv/git/$1
  AliasMatch ^/git/(.*/objects/pack/pack-[0-9a-f]{40}.(pack|idx))$ /srv/git/$1

  Alias /git /srv/git

  <DirectoryMatch "^(/usr/local/bin|${GIT_CORE_DIR}|/srv/git|/opt/twgit/cgi-bin)($|/)">
    Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
    AllowOverride None
    Require all granted
  </DirectoryMatch>

  # <Directory /usr/local/bin>
  # </Directory>

  # <Directory /usr/local/bin>
  #   Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
  #   AllowOverride None
  #   Require all granted
  # </Directory>

  # <Directory ${GIT_CORE_DIR}>
  #   Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
  #   AllowOverride None
  #   Require all granted
  # </Directory>

  # ???
  DocumentRoot /srv/git

  # <Directory /srv/git>
  #   Options Indexes FollowSymLinks MultiViews
  #   AllowOverride None
  #   Require all granted
  # </Directory>

  ErrorLog /proc/self/fd/2
  LogLevel trace1
  CustomLog /proc/self/fd/1 combined
</VirtualHost>

# vim:ft=apache:ts=2:sw=2:et
